{
  "permissions": {
    "allow": [
      "Bash(bd *)",
      "Bash(git status*)",
      "Bash(git log*)",
      "Bash(git diff*)",
      "Bash(git branch*)",
      "Bash(git pull*)",
      "Bash(git push*)",
      "Bash(git add *)",
      "Bash(git commit *)",
      "Bash(sqlite3 *)",
      "Read",
      "Edit",
      "Write",
      "Glob",
      "Grep",
      "WebFetch",
      "WebSearch"
    ],
    "deny": [
      "Bash(rm -rf *)",
      "Bash(git push --force*)",
      "Bash(git reset --hard*)",
      "Bash(git clean -f*)"
    ]
  },
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/01_protect_writes.py",
            "timeout": 10,
            "statusMessage": "Policy: checking write target"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/02_bash_policy.py",
            "timeout": 10,
            "statusMessage": "Policy: validating shell command"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/04_mark_dirty.py",
            "timeout": 5
          }
        ]
      },
      {
        "matcher": "Bash|Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/09_audit_log.py",
            "timeout": 5
          },
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/10_canary_monitor.py",
            "timeout": 5,
            "statusMessage": "Canary: monitoring pressure"
          }
        ]
      }
    ],
    "PostToolUseFailure": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/09_audit_log.py",
            "timeout": 5
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/07_inject_bd_context.py",
            "timeout": 10,
            "statusMessage": "Injecting Beads issue context"
          },
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/11_canary_inject.py",
            "timeout": 5,
            "statusMessage": "Canary: checking pressure"
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "matcher": "manual|auto",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/08_precompact_snapshot.py",
            "timeout": 30,
            "statusMessage": "Saving compaction snapshot"
          }
        ]
      }
    ],
    "SessionStart": [
      {
        "matcher": "startup",
        "hooks": [
          {
            "type": "command",
            "command": "bd ready 2>/dev/null || echo 'No beads issues ready. Use bd create to add work.'"
          }
        ]
      },
      {
        "matcher": "compact",
        "hooks": [
          {
            "type": "command",
            "command": "cat \"$CLAUDE_PROJECT_DIR\"/.claude/state/compaction_snapshot.md 2>/dev/null || echo 'No compaction snapshot available.'",
            "timeout": 5
          }
        ]
      }
    ],
    "SubagentStop": [
      {
        "matcher": "triage-fix|research-taste|dependency-verifier|coordination-momentum|verification-judge|scout|cartographer",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/eval-subagent-stop.py",
            "timeout": 30,
            "statusMessage": "Running post-session evaluation"
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo '--- Session close reminder ---' && git status --short 2>/dev/null && echo '---' && bd list --status=in_progress 2>/dev/null && echo '---' && PHASE=$(cat \"$CLAUDE_PROJECT_DIR\"/.claude/state/system_phase.json 2>/dev/null | python3 -c 'import sys,json; print(json.load(sys.stdin).get(\"phase\",\"\"))' 2>/dev/null || echo '') && [ \"$PHASE\" = 'completion' ] && echo 'PHASE: completion â€” verify all issues addressed, git clean, pushed' || true"
          },
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/12_langsmith_trace.py",
            "timeout": 300,
            "statusMessage": "Sending traces to LangSmith"
          }
        ]
      }
    ]
  }
}
